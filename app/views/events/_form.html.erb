<% provide :title, 'New Events' %>
<%= javascript_include_tag 'bootstrap-datepicker', data: { no_turbolink: true } %>
<%= javascript_include_tag 'bootstrap-timepicker.min', data: { no_turbolink: true } %>
<%= stylesheet_link_tag 'datepicker', data: { no_turbolink: true } %>
<%= stylesheet_link_tag 'bootstrap-timepicker.min', data: { no_turbolink: true } %>

<% start_date = params[:start_date].to_datetime.strftime('%F') if params[:start_date] %>
<% start_time = params[:start_time].to_datetime.strftime('%I:%M %p') if params[:start_date] %>
<% end_time = (params[:end_time].to_datetime + 30.minutes).strftime('%I:%M %p') if params[:start_date] %>

<div class="container">
  <div class="col-lg-6 col-lg-offset-3">
    <%= form_for @event, html: {:class => 'form-horizontal'} do |f| %>

        <div class='form-group'>
          <%= f.label :name, :class => 'control-label' %>
          <%= f.text_field :name, :class => 'form-control', placeholder: 'Name' %>
        </div>
        <div class='form-group'>
          <%= f.label :category, :class => 'control-label' %>
          <%= f.select :category, %w( Scrum PairProgramming ), {}, :class => 'form-control' %>
        </div>


        <div class='form-group'>
          <%= f.label :description %>
          <%= f.text_area :description, :class => 'form-control', 'rows' => 10, placeholder: 'Document body' %>
        </div>


        <div class="form-group">
          <%= f.label :is_all_day, :class => 'control-label' %>
          <%= f.check_box :is_all_day %>
        </div>
        <div class="form-group event_date">
          <%= f.label :from_date, :class => 'control-label' %>
          <% if params[:start_date] %>
              <%= f.text_field :from_date, {:data => {:format => 'yyyy-MM-dd'}, style: 'width:auto;', :class => 'form-control datepicker', :value => "#{start_date}"} %>
          <% else %>
              <%= f.text_field :from_date, {:data => {:format => 'yyyy-MM-dd'}, style: 'width:auto;', :class => 'form-control datepicker'} %>
          <% end %>
        </div>
        <div class="form-group event_time">
          <%= f.label :from_time, :class => 'control-label' %>
          <% if params[:start_date] %>
              <%= f.text_field :from_time, {:data => {:format => 'hh:mm'}, style: 'width:auto;', :class => 'form-control timepicker', :value => "#{start_time}"} %>
          <% else %>
              <%= f.text_field :from_time, {:data => {:format => 'hh:mm'}, style: 'width:auto;', :class => 'form-control timepicker'} %>
          <% end %>
        </div>
        <div class="form-group event_date">
          <%= f.label :to_date, :class => 'control-label' %>
          <% if params[:start_date] %>
              <%= f.text_field :to_date, {:data => {:format => 'yyyy-MM-dd'}, style: 'width:auto;', :class => 'form-control datepicker', :value => "#{start_date}"} %>
          <% else %>
              <%= f.text_field :to_date, {:data => {:format => 'yyyy-MM-dd'}, style: 'width:auto;', :class => 'form-control datepicker'} %>
          <% end %>
        </div>
        <div class="form-group event_time">
          <%= f.label :to_time, :class => 'control-label' %>
          <% if params[:start_date] %>
              <%= f.text_field :to_time, {:data => {:format => 'hh:mm'}, style: 'width:auto;', :class => 'form-control timepicker', :value => "#{end_time}"} %>

          <% else %>
              <%= f.text_field :to_time, {:data => {:format => 'hh:mm'}, style: 'width:auto;', :class => 'form-control timepicker'} %>
          <% end %>
        </div>
        <div class="form-group">
          <%= f.label :repeats, :class => 'control-label' %>
          <%= f.select :repeats, Event::RepeatsOptions, {}, :default => 'never', :class => 'form-control'  %>
          <%= render partial: 'repeats_weekly_options', locals: {f: f} %>
        </div>

        <div class="form-group event_option" id="repeats_options">
          <%= f.label :repeat_ends, :class => 'control-label' %>
          <%= f.select :repeat_ends, Event::RepeatEndsOptions, {}, :class => 'form-control'  %>
        </div>

        <div class="form-group">
          <div id="event_repeat_ends_on">
            <%= f.label :repeat_ends_on, :class => 'control-label' %>
            <%= f.date_select :repeat_ends_on, {}, {style: 'width:auto;'} %>
          </div>
        </div>


        <div class="form-group">
          <%= f.label :time_zone %>
          <%= f.time_zone_select :time_zone, ActiveSupport::TimeZone.us_zones, :default => "London" %>
        </div>

        <div class="form-group">
          <%= link_to 'Cancel', root_path, class: 'btn btn-default' %>
          <%= f.submit 'Save', class: 'btn btn-default', data: {disable_with: 'Working...'} %>
        </div>
    <% end %>
  </div>
</div>
<script>

    $(function () {
      $( ".datepicker" ).datepicker({
        format: 'yyyy-mm-dd'
      });
      $('.timepicker').timepicker();

        var toggle_repeats_yearly_on = function () {
            if ($('#event_repeats_yearly_on').is(':checked')) {
                $('#event_repeats_yearly_on_options').show();
            } else {
                $('#event_repeats_yearly_on_options').hide();
            }
        }
        toggle_repeats_yearly_on();
        $('#event_repeats_yearly_on').on('change', function () {
            toggle_repeats_yearly_on();
        });
        var toggle_event_times = function () {
            if ($('#event_is_all_day').is(':checked')) {
                $('.event_time').hide();
            } else {
                $('.event_time').show();
            }
        }
        toggle_event_times();
        $('#event_is_all_day').on('change', function () {
            toggle_event_times();
        });
        var toggle_event_options = function () {
            $('.event_option').hide();
            switch ($('#event_repeats').val()) {
                case 'never':
                    // Nothing
                    break;
                case 'daily':
                    $('#repeats_options').show();
                    $('#repeats_daily_options').show();
                    break;
                case 'weekly':
                    $('#repeats_options').show();
                    $('#repeats_weekly_options').show();
                    break;
                case 'monthly':
                    $('#repeats_options').show();
                    $('#repeats_monthly_options').show();
                    break;
                case 'yearly':
                    $('#repeats_options').show();
                    $('#repeats_yearly_options').show();
                    break;
            }
        }
        toggle_event_options();
        $('#event_repeats').on('change', function () {
            toggle_event_options();
        });
        var toggle_repeat_ends_on = function () {
            switch ($('#event_repeat_ends').val()) {
                case 'never':
                    $('#event_repeat_ends_on').hide();
                    break;
                case 'on':
                    $('#event_repeat_ends_on').show();
                    break;
            }
        }
        toggle_repeat_ends_on();
        $('#event_repeat_ends').on('change', function () {
            toggle_repeat_ends_on();
        });
        var toggle_repeats_monthly = function () {
            switch ($('#event_repeats_monthly').val()) {
                case 'each':
                    $('#event_repeats_monthly_each').show();
                    $('#event_repeats_monthly_on').hide();
                    break;
                case 'on':
                    $('#event_repeats_monthly_each').hide();
                    $('#event_repeats_monthly_on').show();
                    break;
            }
        }
        toggle_repeats_monthly();
        $('#event_repeats_monthly').on('change', function () {
            toggle_repeats_monthly();
        });
    });

</script>

<script>
</script>

<style>

    #repeats_options {
        display: none;
    }

    #repeats_daily_options {
        display: none;
    }

    #repeats_weekly_options {
        display: none;
    }

    #repeats_monthly_options {
        display: none;
    }

    #repeats_yearly_options {
        display: none;
    }

</style>



